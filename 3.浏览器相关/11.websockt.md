## websocket
关键词: 单个TCP链接 一次握手  持久链接 全双工
WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议.
WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输

之前的实现推送都是不断的ajax轮询，浏览器一定间隔的不断请求，请求头有开销，回浪费很多资源

HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯

### 细节
客户端浏览器首先要向服务器发起一个 HTTP 请求，请求头要设置一些信息： connect 和 upgrade字段。
Connection 必须设置 Upgrade，表示客户端希望连接升级。
Upgrade 字段必须设置 Websocket，表示希望升级到 Websocket 协议

### 补充
Socket 是传输控制层协议，WebSocket 是应用层协议

### 轮询和长轮询
并非所有的浏览器都支持webSocket协议
- Poll即轮询，浏览器定时向服务器请求轮询的方法不断发送或拉取消息，实时性差，而且没有消息时也不断轮询，浪费系统资源
- long-poll 
HTTP请求可以设置一个较长的Timeout等待时间，只要服务器在这个段时间内进行响应，请求就会立即返回结果，如果没有返回，浏览器响应超时并重新发起一个长轮询请求。
- 场景，用户使用移动端扫描二维码登录网站，成功后桌面浏览器页面自动响应跳转进入一个新的登录后页面。用户打开桌面浏览器页面后会立即发送一个用户登录状态查询的长轮询请求，用户在移动端扫描二维码，扫描成功移动端开会带哦用接口改变用户的登录状态，此时服务器可以不断轮询用户登录状态改变通知，一旦检测到用户端使用移动端扫码登录，就将用户登录状态发送给浏览器的长轮询请求。


